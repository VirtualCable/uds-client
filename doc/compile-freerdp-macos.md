# Very simple guide to building FreeRDP on mac
# Needs homebrew and the following packages installed:
# Also python is needed (maybe pyenv to manage versions)
# brew install git cmake pkg-config libusb openssl ffmpeg jpeg-turbo openh264
# Note:
# To ensure the macos compatibility target is set to at least 12.0
# export MACOSX_DEPLOYMENT_TARGET=12.0
# brew reinstall --build-from-source ...


## Clone the FreeRDP repository

git clone https://github.com/FreeRDP/FreeRDP.git
cd FreeRDP

cmake -B build \
  -DCMAKE_BUILD_TYPE=Release \
  -DCMAKE_OSX_DEPLOYMENT_TARGET=12.0 \
  -DWITH_CLIENT_COMMON=ON \
  -DWITH_INTERNAL_MD4=ON \
  -DWITH_INTERNAL_MD5=ON \
  -DWITH_INTERNAL_RC4=ON \
  -DWITH_SDL=OFF \
  -DWITH_SERVER=OFF \
  -DWITH_SHADOW=OFF \
  -DBUILD_TESTING=OFF \
  -DWITH_MANPAGES=OFF \
  -DWITH_CHANNELS=ON \
  -DWITH_RDPSND=ON \
  -DWITH_AUDIN=ON \
  -DWITH_CLIENT_SDL=OFF \
  -DWITH_LIBUSB=ON \
  -DWITH_URBDRC=ON \
  -DWITH_AAD=ON \
  -DWITH_WINPR_JSON=ON \
  -DWITH_VERBOSE_WINPR_ASSERT=OFF \
  -DWITH_OPENH264=ON \
  -DWITH_DSP_FFMPEG=ON \
  -DWITH_MACAUDIO=ON \
  -DWITH_RDPGFX=ON \
  -DWITH_DYNVC=ON \
  -DWITH_RDPGFX=ON \
  -DWITH_DYNVC=ON \
  -DCHANNEL_TELEMETRY_CLIENT=ON \
  -DCHANNEL_TELEMETRY_SERVER=OFF \
  -DWITH_DEBUG_ALL=OFF \
  -DWITH_DEBUG_CAPABILITIES=OFF \
  -DWITH_DEBUG_CERTIFICATE=OFF \
  -DWITH_DEBUG_CHANNELS=OFF \
  -DWITH_DEBUG_CLIPRDR=OFF \
  -DWITH_DEBUG_CODECS=OFF \
  -DWITH_DEBUG_DVC=OFF \
  -DWITH_DEBUG_KBD=OFF \
  -DWITH_DEBUG_LICENSE=OFF \
  -DWITH_DEBUG_MUTEX=OFF \
  -DWITH_DEBUG_NEGO=OFF \
  -DWITH_DEBUG_NLA=OFF \
  -DWITH_DEBUG_NTLM=OFF \
  -DWITH_DEBUG_RAIL=OFF \
  -DWITH_DEBUG_RDP=OFF \
  -DWITH_DEBUG_RDPDR=OFF \
  -DWITH_DEBUG_RDPEI=OFF \
  -DWITH_DEBUG_RDPGFX=OFF \
  -DWITH_DEBUG_REDIR=OFF \
  -DWITH_DEBUG_RFX=OFF \
  -DWITH_DEBUG_RINGBUFFER=OFF \
  -DWITH_DEBUG_SCARD=OFF \
  -DWITH_DEBUG_SDL_EVENTS=OFF \
  -DWITH_DEBUG_SDL_KBD_EVENTS=OFF \
  -DWITH_DEBUG_SND=OFF \
  -DWITH_DEBUG_SVC=OFF \
  -DWITH_DEBUG_THREADS=OFF \
  -DWITH_DEBUG_TIMEZONE=OFF \
  -DWITH_DEBUG_TRANSPORT=OFF \
  -DWITH_DEBUG_TSG=OFF \
  -DWITH_DEBUG_URBDRC=OFF \
  -DWITH_DEBUG_WND=OFF \
  -DWITH_DEBUG_X11=OFF \
  -DWITH_DEBUG_X11_LOCAL_MOVESIZE=OFF \
  -DWITH_DEBUG_XV=OFF

cmake --build build --config Release --parallel 16
cmake --install ./build/ --config Release --prefix /usr/local